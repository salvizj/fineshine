---
import { type LanguageCode, useTranslations } from "../i18n/utils"
import LanguagePicker from "./LanguagePicker.astro"
import ThemePicker from "./ThemePicker.astro"

const { languageCode } = Astro.props as { languageCode: LanguageCode }
const t = useTranslations(languageCode)
---

<ul
	class="w-full max-w-7xl px-4 py-2 mx-auto flex items-center justify-between"
>
	<li class="flex items-center gap-4">
		<a href={`/`}>
			<svg
				class="h-8 w-auto text-blue-600"
				xmlns="http://www.w3.org/2000/svg"
				fill="currentColor"
				viewBox="0 0 24 24"
			>
				<path
					d="M3 12l2-4h14l2 4v5a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-1H9v1a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-5zM6 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm12 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"
				></path>
			</svg>
		</a>
	</li>
	<!-- Default -->
	<div class="md:flex md:flex-row md:justify-center md:gap-4 hidden">
		<div class="flex flex-row gap-4">
			<li class="flex items-center gap-4">
				<a href={`#contacts`}> {t("contacts")}</a>
			</li>
			<li class="flex items-center gap-4">
				<a href={`#services`}> {t("services")}</a>
			</li>
		</div>
		<li class="flex items-center gap-4">
			<ThemePicker />
			<LanguagePicker languageCode={languageCode} />
		</li>
	</div>
	<!-- Open Button -->
	<svg
		xmlns="http://www.w3.org/2000/svg"
		width="35"
		height="36"
		fill="currentColor"
		class="bi bi-list nav-collapsed md:hidden"
		id="nav-open-btn"
		viewBox="0 0 16 16"
	>
		<path
			fill-rule="evenodd"
			d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"
		></path>
	</svg>

	<!-- Fullscreen Overlay + Right Menu -->
	<div
		class="nav-open hidden fixed inset-0 z-50 bg-black bg-opacity-50 md:hidden"
	>
		<div
			class="absolute top-0 right-0 w-3/4 h-full shadow-lg flex flex-col p-4 gap-6"
		>
			<!-- Close Button -->
			<div class="flex justify-end">
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="36"
					height="36"
					fill="currentColor"
					class="bi bi-x cursor-pointer"
					id="nav-collapse-btn"
					viewBox="0 0 16 16"
				>
					<path
						d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"
					></path>
				</svg>
			</div>

			<!-- Navigation Menu -->
			<ul class="flex flex-col gap-4 mb-6">
				<li>
					<a href="#contacts" class="text-lg font-semibold"
						>{t("contacts")}</a
					>
				</li>
				<li>
					<a href="#services" class="text-lg font-semibold"
						>{t("services")}</a
					>
				</li>
			</ul>

			<!-- Utility Controls -->
			<div class="flex gap-4 mt-4">
				<ThemePicker />
				<LanguagePicker languageCode={languageCode} />
			</div>
		</div>
	</div>
</ul>

<script>
	let navOpenBtn: HTMLElement | null = null
	let navCollapseBtn: HTMLElement | null = null
	let navOpen: HTMLElement | null = null
	let navCollapsed: HTMLElement | null = null

	const resetNavIfHidden = () => {
		if (!navOpenBtn || !navOpen || !navCollapsed) return

		const navOpenBtnIsVisible =
			window.getComputedStyle(navOpenBtn).display !== "none"

		if (!navOpenBtnIsVisible) {
			navOpen.classList.add("hidden")
			navCollapsed.classList.remove("hidden")
			navOpenBtn.classList.remove("hidden")
		}
	}

	document.addEventListener("DOMContentLoaded", () => {
		navOpenBtn = document.getElementById("nav-open-btn")
		navCollapseBtn = document.getElementById("nav-collapse-btn")
		navOpen = document.querySelector(".nav-open")
		navCollapsed = document.querySelector(".nav-collapsed")

		if (navOpenBtn && navCollapseBtn && navOpen && navCollapsed) {
			navOpenBtn.addEventListener("click", () => {
				navOpen!.classList.remove("hidden")
				navCollapsed!.classList.add("hidden")
				navOpenBtn!.classList.add("hidden")
			})

			navCollapseBtn.addEventListener("click", () => {
				navOpen!.classList.add("hidden")
				navCollapsed!.classList.remove("hidden")
				navOpenBtn!.classList.remove("hidden")
			})
		}
	})

	window.addEventListener("resize", resetNavIfHidden)
</script>
